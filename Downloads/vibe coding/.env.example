# ============================================================================
# AIRCRAFT DEFECT DETECTION SYSTEM - ENVIRONMENT CONFIGURATION
# ============================================================================
#
# This file contains all environment variables required for the application.
# Copy this file to .env and update the values according to your environment.
#
# IMPORTANT: Never commit .env file to version control!
#
# Configuration Profiles:
# - Development: Use local services (MongoDB, Redis) and local storage
# - Production: Use cloud services (MongoDB Atlas, Redis Cloud, AWS S3)
# ============================================================================

# ============================================================================
# APPLICATION CONFIGURATION
# ============================================================================

# Environment mode: development, production, test
NODE_ENV=development

# Backend server port
PORT=3000

# Application base URL (used for email links, redirects, etc.)
APP_BASE_URL=http://localhost:3000

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================

# MongoDB Configuration
# Development: mongodb://localhost:27017/aircraft_detection
# Production: mongodb+srv://<username>:<password>@cluster.mongodb.net/aircraft_detection
# Docker: mongodb://mongo:27017/aircraft_detection
MONGODB_URI=mongodb://localhost:27017/aircraft_detection

# MongoDB credentials (for Docker setup)
MONGO_ROOT_USERNAME=admin
MONGO_ROOT_PASSWORD=admin123
MONGO_DATABASE=aircraft_detection

# MongoDB connection pool settings
MONGO_POOL_SIZE=100
MONGO_CONNECT_TIMEOUT_MS=10000

# ============================================================================
# REDIS CONFIGURATION
# ============================================================================

# Redis connection URL
# Development: redis://localhost:6379
# Production: redis://:password@host:port
# Docker: redis://redis:6379
REDIS_URL=redis://localhost:6379

# Redis password (for Docker setup)
REDIS_PASSWORD=redis123

# Redis cache TTL settings (in seconds)
REDIS_SESSION_TTL=86400
REDIS_MODEL_CACHE_TTL=0
REDIS_INSPECTION_CACHE_TTL=3600

# ============================================================================
# AUTHENTICATION & SECURITY
# ============================================================================

# JWT Configuration
# IMPORTANT: Generate a strong random secret for production!
# Example: openssl rand -base64 64
JWT_SECRET=your_jwt_secret_key_here_change_in_production
JWT_EXPIRATION=24h
JWT_REFRESH_EXPIRATION=7d

# Password hashing
BCRYPT_SALT_ROUNDS=10

# Account lockout settings
MAX_LOGIN_ATTEMPTS=5
LOCKOUT_DURATION_MINUTES=15

# Session configuration
SESSION_SECRET=your_session_secret_here_change_in_production

# ============================================================================
# STORAGE CONFIGURATION
# ============================================================================

# Storage mode: true for local filesystem, false for AWS S3
USE_LOCAL_STORAGE=true

# Local storage directory (when USE_LOCAL_STORAGE=true)
UPLOAD_DIR=./uploads

# AWS S3 Configuration (when USE_LOCAL_STORAGE=false)
# Get credentials from AWS IAM Console
AWS_S3_BUCKET=aircraft-images
AWS_ACCESS_KEY_ID=your_aws_access_key
AWS_SECRET_ACCESS_KEY=your_aws_secret_key
AWS_REGION=us-east-1

# S3 settings
S3_SIGNED_URL_EXPIRATION=3600

# ============================================================================
# OPENAI API CONFIGURATION
# ============================================================================

# OpenAI API Key
# Get from: https://platform.openai.com/api-keys
OPENAI_API_KEY=your_openai_api_key_here

# GPT Vision model configuration
GPT_VISION_MODEL=gpt-4-vision-preview
GPT_VISION_MAX_TOKENS=1000
GPT_VISION_TEMPERATURE=0.2

# API usage limits
OPENAI_MONTHLY_BUDGET=100
OPENAI_ALERT_THRESHOLD=80

# ============================================================================
# ML SERVICE CONFIGURATION
# ============================================================================

# ML Service URL
# Development: http://localhost:5000
# Docker: http://ml-service:5000
ML_SERVICE_URL=http://localhost:5000

# Flask environment
FLASK_ENV=development
ML_SERVICE_PORT=5000

# ML service timeout (milliseconds)
ML_SERVICE_TIMEOUT=30000

# ============================================================================
# YOLO MODEL CONFIGURATION
# ============================================================================

# YOLOv8 model path
# Options: yolov8n.pt (nano), yolov8s.pt (small), yolov8m.pt (medium), yolov8l.pt (large)
YOLO_MODEL_PATH=./ml-service/models/yolov8n.pt

# Detection confidence threshold (0.0 - 1.0)
YOLO_CONFIDENCE_THRESHOLD=0.5

# Non-Maximum Suppression IoU threshold
YOLO_NMS_IOU_THRESHOLD=0.45

# Image size for inference (640, 1280, etc.)
YOLO_IMAGE_SIZE=640

# Device: cpu, cuda, mps (for Mac M1/M2)
YOLO_DEVICE=cpu

# ============================================================================
# ENSEMBLE MODEL CONFIGURATION
# ============================================================================

# Ensemble weights (must sum to 1.0)
ENSEMBLE_YOLO_WEIGHT=0.6
ENSEMBLE_GPT_WEIGHT=0.4

# NMS IoU threshold for ensemble aggregation
NMS_IOU_THRESHOLD=0.5

# Minimum confidence for ensemble predictions
ENSEMBLE_MIN_CONFIDENCE=0.5

# ============================================================================
# FILE UPLOAD CONFIGURATION
# ============================================================================

# Maximum file size in bytes (50MB = 52428800)
MAX_FILE_SIZE=52428800

# Allowed MIME types (comma-separated)
ALLOWED_FILE_TYPES=image/jpeg,image/png,image/tiff

# Image dimension constraints (pixels)
MIN_IMAGE_DIMENSION=640
MAX_IMAGE_DIMENSION=4096

# Maximum number of files per upload
MAX_FILES_PER_UPLOAD=10

# ============================================================================
# SECURITY CONFIGURATION
# ============================================================================

# CORS Configuration
# Development: http://localhost:3000,http://127.0.0.1:3000
# Production: https://yourdomain.com
# Allow all: *
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000

# CORS credentials
CORS_ALLOW_CREDENTIALS=true

# Rate Limiting
# General API rate limit (requests per window)
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=100

# Authentication endpoints rate limit (stricter)
AUTH_RATE_LIMIT_WINDOW_MS=900000
AUTH_RATE_LIMIT_MAX_REQUESTS=10

# Upload endpoints rate limit
UPLOAD_RATE_LIMIT_WINDOW_MS=60000
UPLOAD_RATE_LIMIT_MAX_REQUESTS=20

# Helmet.js security headers
HELMET_ENABLED=true

# Content Security Policy
CSP_ENABLED=false

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================

# Log level: error, warn, info, http, verbose, debug, silly
LOG_LEVEL=info

# Log file paths
LOG_DIR=./logs
ERROR_LOG_FILE=./logs/error.log
COMBINED_LOG_FILE=./logs/combined.log
WARNINGS_LOG_FILE=./logs/warnings.log

# Log rotation
LOG_MAX_SIZE=10m
LOG_MAX_FILES=14d

# Console logging
LOG_CONSOLE_ENABLED=true
LOG_CONSOLE_COLORIZE=true

# ============================================================================
# MONITORING & PERFORMANCE
# ============================================================================

# Enable performance monitoring
PERFORMANCE_MONITORING=true

# Request timeout (milliseconds)
REQUEST_TIMEOUT=30000

# Database query timeout (milliseconds)
DB_QUERY_TIMEOUT=10000

# Health check interval (milliseconds)
HEALTH_CHECK_INTERVAL=30000

# ============================================================================
# EMAIL CONFIGURATION (Optional)
# ============================================================================

# Email service for notifications
EMAIL_ENABLED=false
EMAIL_SERVICE=gmail
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_SECURE=false
EMAIL_USER=your_email@gmail.com
EMAIL_PASSWORD=your_app_password
EMAIL_FROM=noreply@aircraft-detection.com

# ============================================================================
# DEFECT CLASSES CONFIGURATION
# ============================================================================

# Supported defect classes (comma-separated)
DEFECT_CLASSES=damaged_rivet,missing_rivet,filiform_corrosion,missing_panel,paint_detachment,scratch,composite_damage,random_damage,burn_mark,scorch_mark,metal_fatigue,crack

# ============================================================================
# DEVELOPMENT & DEBUGGING
# ============================================================================

# Enable debug mode
DEBUG=false

# Enable API request logging
API_LOGGING=true

# Enable SQL query logging
DB_LOGGING=false

# Mock ML service (for testing without ML dependencies)
MOCK_ML_SERVICE=false

# Seed database with test data
SEED_DATABASE=false

# ============================================================================
# DOCKER CONFIGURATION
# ============================================================================

# Docker-specific overrides (uncomment when using Docker)
# MONGODB_URI=mongodb://mongo:27017/aircraft_detection
# REDIS_URL=redis://redis:6379
# ML_SERVICE_URL=http://ml-service:5000
